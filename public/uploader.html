<!doctype html>
<meta charset="utf-8" />
<title>Uploader (fallback)</title>
<style>
  body { font-family: system-ui, sans-serif; max-width: 720px; margin: 40px auto; padding: 0 16px; }
  label { display:block; margin:12px 0 6px; font-size:14px; }
  input, button { padding: 8px 10px; }
  button { margin-top: 16px; }
  #msg { margin-top: 16px; font-size: 14px; }
</style>
<h1>Upload de Relatório (Fallback)</h1>
<label>Slug (AAAA-MM)</label>
<input id="slug" placeholder="2025-10" />
<label>Título</label>
<input id="title" placeholder="Relatório de Outubro de 2025" />
<label>Resumo (opcional)</label>
<input id="summary" />
<label>Global (opcional, nº de casos)</label>
<input id="global" />
<label>Arquivo PDF</label>
<input id="file" type="file" accept="application/pdf" />
<button id="btn">Enviar</button>
<div id="msg"></div>
<script>
  const $ = id => document.getElementById(id);
  $('btn').onclick = async () => {
    const fd = new FormData();
    fd.append('slug', $('slug').value.trim());
    fd.append('title', $('title').value.trim());
    if ($('summary').value.trim()) fd.append('summary', $('summary').value.trim());
    if ($('global').value.trim())  fd.append('global', $('global').value.trim());
    const f = $('file').files[0];
    if (!f) { $('msg').textContent = 'Selecione um PDF.'; return; }
    fd.append('file', f);
    $('msg').textContent = 'Enviando…';
    try {
      const res = await fetch('/api/upload', { method: 'POST', body: fd });
      const json = await res.json().catch(()=> ({}));
      $('msg').textContent = (res.ok ? 'OK: ' : 'Erro: ') + (json.msg || res.status);
      if (json.file) $('msg').innerHTML += `<br/>URL: <a href="${json.file}" target="_blank">${json.file}</a>`;
    } catch (e) {
      $('msg').textContent = 'Falha de rede: ' + e.message;
    }
  };
</script>
